<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Forecasting Algorithms</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="jquery.min.js"></script>
    <script src="d3.v4.min.js"></script>
    <script src="semantic.min.js"></script>
    <link rel="stylesheet" href="semantic.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <link href="https://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet">

  </head>
  <style media="screen">
    h2 {
      font-family: 'Comfortaa', cursive;
      font-size: 20px;
    }
  </style>
  <body>
    <div class="row" style="margin:5%;">
      <div class="ui two column centered grid">
        <div class="column">
          <h1 style="text-align:center;">Analysis of Crypto Currency Financial Forecasting Algorithms</h1>
        </div>
        <div class="four column centered row">
          <div class="column">
            <select class="ui selection dropdown" style="width:100%">
              <option value="">1 minute</option>
              <option value="">5 minutes</option>
              <option value="">15 minutes</option>
              <option value="">30 minutes</option>
              <option value="">1 hour</option>
              <option value="">6 hour</option>
              <option value="">12 hour</option>
              <option value="">24 hour</option>
            </select>
          </div>
          <div class="column">
            <select class="ui selection dropdown" style="width:100%">
              <option value="">10 periods</option>
              <option value="">50 periods</option>
              <option value="">100 periods</option>
              <option value="">200 periods</option>
            </select>
          </div>
        </div>

        <div class="two column centered row">
          <div class="ui toggle checkbox" data-position="bottom left">
            <input id="update_toggle" name="public" type="checkbox">
            <label>Toggle Live Update</label>
          </div>
        </div>


      </div>
    </div>



    <div class="ui internally celled grid" id="svg_root">



      <div class="row" style="height:0px;">

        <div class="three wide column">
          <div class="ui icon message">
            <i class="material-icons">attach_money</i>
            <div class="content">
              <div class="header">
              </div>
              <p></p>
              <p></p>
            </div>
          </div>
        </div>

        <div class="ten wide column">
          <div  class="ui center aligned container" style="width:100%;padding:0% 5% 5% 5%;">
            <div id="00_seg" class="ui segment display_seg" style="width:100%;"></div>
          </div>
        </div>

        <div class="three wide column">
          <div class="ui icon message">
            <div class="content">
              <i class="material-icons" >assessment</i>
              <p>rank</p>
              <p>current price usd</p>
              <p>current price btc</p>
              <p>24hr volume</p>
              <p>total supply</p>
              <p>% change 1hr</p>
              <p>% change 24hr</p>
              <p>% change 7d</p>
              <p>last updated</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>



<script type="text/javascript">

  class Q {
    constructor(arr) {
      this.supporting_array = arr
    }


    enqueue(x) {
      this.supporting_array.push(x)
    }
    dequeue() {
      return this.supporting_array.shift()
    }
    empty() {
      return this.supporting_array.length == 0
    }
  }

  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/round
  function round(number, precision) {
    var shift = function (number, precision, reverseShift) {
      if (reverseShift) {
        precision = -precision;
      }
      numArray = ("" + number).split("e");
      return +(numArray[0] + "e" + (numArray[1] ? (+numArray[1] + precision) : precision));
    };
    return shift(Math.round(shift(number, precision, false)), precision, true);
  }



  var state_of_buttons = {}


  let funx = {
    price : function(symbol) {
      console.log('price called')
      socket.emit('req price n periods', {currency : symbol, periods : initial_time_periods})
    },
    ema : function(symbol) {
      console.log('ema called')
      socket.emit('req ema n periods', {currency : symbol, periods : initial_time_periods})
    },
    sma : function(symbol) {
      console.log('sma called')
      socket.emit('req sma n periods', {currency : symbol, periods : initial_time_periods})
    },
    wiki : function(symbol) {
      console.log('wiki called')
      socket.emit('req wiki n periods', {currency : symbol, periods : initial_time_periods})
    }
  }

  var unix_ms_to_date_string = function(unix_time_ms) {
        let date = new Date(unix_time_ms)
        let month = date.getMonth()
        let day_of_month = date.getDate()
        let hours = date.getHours()
        let minutes = "0" + date.getMinutes()
        let seconds = "0" + date.getSeconds()
        let formattedTime = (month+1)+':'+day_of_month+'; '+hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
        return formattedTime
  }

  var  create_markup_structure = function(data) {
    // make svgs for each currency
    var svg_root = document.getElementById('svg_root')
    for (let i  = 0; i <  data.currencies.length; i++) {
      let row = document.createElement('div')
      row.classList.add("row")
      row.setAttribute("currency", data.currencies[i])

      let three_wide_col = document.createElement('div')
      three_wide_col.classList = ['three wide column']


      var left_ui_icon_message = document.createElement('div')
      left_ui_icon_message.classList = ['ui icon message']
      left_ui_icon_message.setAttribute("style", "background-color : " + color_arr[0])


      var left_ui_icon_message_content = document.createElement('div')
      left_ui_icon_message_content.classList = ['content']

      // var left_ui_icon_message_content_icon = document.createElement('i')
      // left_ui_icon_message_content_icon.classList = ['material-icons']
      // var left_ui_icon_message_content_icon_text_node =  document.createTextNode("fingerprint")
      // left_ui_icon_message_content_icon.setAttribute("style", "color : white;display:inline;")
      // left_ui_icon_message_content_icon.appendChild(left_ui_icon_message_content_icon_text_node)



      var currency_id = document.createElement('h2')
      currency_id.setAttribute("currency", data.currencies[i])
      currency_id.classList = ["currency_id_root " + data.currencies[i]]
      currency_id.setAttribute("id", "currency_id_root_"+data.currencies[i])
      currency_id.setAttribute("style", "color:white;display:inline")

      var currency_symbol = document.createElement('h2')
      currency_symbol.setAttribute("currency", data.currencies[i])
      currency_symbol.classList = ["currency_symbol_root " + data.currencies[i]]
      currency_symbol.setAttribute("id", "currency_symbol_root_"+data.currencies[i])
      currency_symbol.setAttribute("style", "color:white;c")


      // left_ui_icon_message_content.appendChild(left_ui_icon_message_content_icon)
      left_ui_icon_message_content.appendChild(currency_id)
      left_ui_icon_message_content.appendChild(currency_symbol)



      left_ui_icon_message.appendChild(left_ui_icon_message_content)
      three_wide_col.appendChild(left_ui_icon_message)


      let ten_wide_col = document.createElement('div')
      ten_wide_col.classList = ['ten wide column']

      let ui_align_container = document.createElement('div')
      ui_align_container.classList =  ['ui center aligned container']
      ui_align_container.setAttribute("style", "padding:0% 1% 1% 1%; width:100%;")

      let ui_segment_display = document.createElement('div')
      ui_segment_display.classList = ['ui segment display_seg']
      ui_segment_display.setAttribute("style", "width:100%;")
      ui_segment_display.setAttribute("currency", data.currencies[i])

      let ui_four_top_attached_buttons = document.createElement('div')
      ui_four_top_attached_buttons.classList = ['ui four top attached buttons ctrl_buttons']
      ui_four_top_attached_buttons.setAttribute("currency", data.currencies[i])

      var ui_active_button_price = document.createElement('div')
      ui_active_button_price.classList = ['ui active button price_button ' + data.currencies[i]]
      ui_active_button_price.setAttribute("funx", "price")
      ui_active_button_price.appendChild(document.createTextNode("price"))

      var ui_button_ema = document.createElement('div')
      ui_button_ema.classList = ['ui button ema_button ' + data.currencies[i]]
      ui_button_ema.setAttribute("funx", "ema")
      ui_button_ema.appendChild(document.createTextNode("EMA"))


      var ui_button_sma = document.createElement('div')
      ui_button_sma.classList = ['ui button sma_button ' + data.currencies[i]]
      ui_button_sma.setAttribute("funx", "sma")
      ui_button_sma.appendChild(document.createTextNode("SMA"))

      var ui_button_wiki = document.createElement('div')
      ui_button_wiki.classList = ['ui button wiki_views_button ' + data.currencies[i]]
      ui_button_wiki.setAttribute("funx", "wiki")
      ui_button_wiki.appendChild(document.createTextNode("Wiki Views"))

      ui_four_top_attached_buttons.appendChild(ui_active_button_price)
      ui_four_top_attached_buttons.appendChild(ui_button_ema)
      ui_four_top_attached_buttons.appendChild(ui_button_sma)
      ui_four_top_attached_buttons.appendChild(ui_button_wiki)

      ui_segment_display.appendChild(ui_four_top_attached_buttons)

      let svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
      svg.classList = ['display_svg']
      svg.setAttribute("height", "500")
      svg.setAttribute("style", "margin-top : 5px;")

      svg.setAttribute("currency", data.currencies[i])
      svg.setAttribute("id", data.currencies[i])

      ui_segment_display.appendChild(svg)
      ui_align_container.appendChild(ui_segment_display)
      ten_wide_col.appendChild(ui_align_container)

      let three_wide_col_second = document.createElement('div')
      three_wide_col_second.classList = ['three wide column']
      // three_wide_col_second.setAttribute("style", "background-color : " + color_arr[1])



      var ui_icon_message = document.createElement('div')
      ui_icon_message.classList = ['ui icon message']
      // ui_icon_message.setAttribute("style", "background-color : " + color_arr[3])


      var ui_icon_message_content = document.createElement('div')
      ui_icon_message_content.classList = ['content']

      var ui_icon_message_content_icon = document.createElement('i')
      ui_icon_message_content_icon.classList = ['material-icons']
      var ui_icon_message_content_icon_text_node =  document.createTextNode("assessment")
      ui_icon_message_content_icon.appendChild(ui_icon_message_content_icon_text_node)



      // TEXT NODE START
      var rank = document.createElement('h6')
      rank.setAttribute("currency", data.currencies[i])
      rank.classList = ["rank_root " + data.currencies[i]]
      rank.setAttribute("id", "rank_root_"+data.currencies[i])

      var current_price_usd = document.createElement('h6')
      current_price_usd.setAttribute("currency", data.currencies[i])
      current_price_usd.classList = ["current_price_usd_root " + data.currencies[i]]
      current_price_usd.setAttribute("id", "current_price_usd_root_"+data.currencies[i])



      var current_price_btc = document.createElement('h6')
      current_price_btc.setAttribute("currency", data.currencies[i])
      current_price_btc.classList = ["current_price_btc_root " + data.currencies[i]]
      current_price_btc.setAttribute("id", "current_price_btc_root_"+data.currencies[i])

      var market_cap_usd = document.createElement('h6')
      market_cap_usd.setAttribute("currency", data.currencies[i])
      market_cap_usd.classList = ["market_cap_usd_root " + data.currencies[i]]
      market_cap_usd.setAttribute("id", "market_cap_usd_root_"+data.currencies[i])


      var twenty_four_hr_volume = document.createElement('h6')
      twenty_four_hr_volume.setAttribute("currency", data.currencies[i])
      twenty_four_hr_volume.classList = ["twenty_four_hr_volume_root " + data.currencies[i]]
      twenty_four_hr_volume.setAttribute("id", "twenty_four_hr_volume_root_"+data.currencies[i])


      var total_supply = document.createElement('h6')
      total_supply.setAttribute("currency", data.currencies[i])
      total_supply.classList = ["total_supply_root " + data.currencies[i]]
      total_supply.setAttribute("id", "total_supply_root_"+data.currencies[i])


      var percent_change_1_hr = document.createElement('h6')
      percent_change_1_hr.setAttribute("currency", data.currencies[i])
      percent_change_1_hr.classList = ["percent_change_1_hr_root " + data.currencies[i]]
      percent_change_1_hr.setAttribute("id", "percent_change_1_hr_root_"+data.currencies[i])


      var percent_change_24_hr = document.createElement('h6')
      percent_change_24_hr.setAttribute("currency", data.currencies[i])
      percent_change_24_hr.classList = ["percent_change_24_hr_root " + data.currencies[i]]
      percent_change_24_hr.setAttribute("id", "percent_change_24_hr_root_"+data.currencies[i])


      var percent_change_7_days = document.createElement('h6')
      percent_change_7_days.setAttribute("currency", data.currencies[i])
      percent_change_7_days.classList = ["percent_change_7_days_root " + data.currencies[i]]
      percent_change_7_days.setAttribute("id", "percent_change_7_days_root_"+data.currencies[i])


      var last_updated = document.createElement('h6')
      last_updated.setAttribute("currency", data.currencies[i])
      last_updated.classList = ["last_updated_root " + data.currencies[i]]
      last_updated.setAttribute("id", "last_updated_root_"+data.currencies[i])

      // TEXT NODE END


      ui_icon_message_content.appendChild(ui_icon_message_content_icon)
      ui_icon_message_content.appendChild(rank)
      ui_icon_message_content.appendChild(current_price_usd)
      ui_icon_message_content.appendChild(current_price_btc)
      ui_icon_message_content.appendChild(market_cap_usd)
      ui_icon_message_content.appendChild(twenty_four_hr_volume)
      ui_icon_message_content.appendChild(total_supply)
      ui_icon_message_content.appendChild(percent_change_1_hr)
      ui_icon_message_content.appendChild(percent_change_24_hr)
      ui_icon_message_content.appendChild(percent_change_7_days)
      ui_icon_message_content.appendChild(last_updated)

      ui_icon_message.appendChild(ui_icon_message_content)
      three_wide_col_second.appendChild(ui_icon_message)


      row.appendChild(three_wide_col)
      row.appendChild(ten_wide_col)
      row.appendChild(three_wide_col_second)

      svg_root.appendChild(row)
    }


    // set the width of  the  svg according to the width of the pusher
    var width_of_seg = document.getElementById('00_seg').getBoundingClientRect().width
    let display_svgs = document.getElementsByTagName('svg')

    // set the width of the svgs
    for (var i = 0; i < display_svgs.length; i++) { display_svgs[i].setAttribute("width", width_of_seg-20) }


    // var state_of_buttons = {}
    for (var i = 0; i < data.currencies.length; i++) {
      state_of_buttons[data.currencies[i]] = {
        'price' : true,
        'ema' : false,
        'sma' : false,
        'wiki' : false,
        'time_periods' : 200
      }
    }


    // select control buttons
    let ctrl_buttons = document.getElementsByClassName('ctrl_buttons')
    // for each set of buttons...
    for (let x = 0; x < ctrl_buttons.length;x++) {
      // for each button ...
      for (let i = 0; i < ctrl_buttons[x].childNodes.length; i++) {
        // add event listener to each button
        ctrl_buttons[x].childNodes[i].addEventListener('click', function() {

          var key = ctrl_buttons[x].getAttribute('currency')
          for (xxx in state_of_buttons[key]) { state_of_buttons[key][xxx] = false }
          state_of_buttons[key][this.getAttribute("funx")] = true
          // console.log(state_of_buttons)

          // console.log(state_of_buttons[key][this.getAttribute("funx")])

          for (let ii = 0; ii < ctrl_buttons[x].childNodes.length; ii++) { /* deactivate other  buttons */ ctrl_buttons[x].childNodes[ii].classList.remove('active') }
          this.classList.add('active') // activate this one
          // remove svg contents
          d3.select("#"+ctrl_buttons[x].getAttribute('currency'))
            .selectAll("*")
            .remove()
          // call function to emit request to  server for more data
          funx[this.getAttribute("funx")](ctrl_buttons[x].getAttribute('currency'))

        })
      }
    }
  }
</script>


<script type="text/javascript">
  var initial_time_periods = 200
  var currency = 'BTC'
  var socket = io.connect('http://localhost:8080');

  var list_of_currencies = null

  socket.on('currencies', function(data) {
    create_markup_structure(data)

    list_of_currencies = data.currencies.slice()

    for (let i  = 0; i <  data.currencies.length; i++) {
      socket.emit('req price n periods', {currency : data.currencies[i], periods : initial_time_periods})
      socket.emit('req assessment', {currency : data.currencies[i]})
    }
  })

</script>


<script type="text/javascript">


  var start_interval = function() {

    var refresh_queue = new  Q(list_of_currencies)
    outer_interval = setInterval(function() {
      clearInterval(inner_interval)
      refresh_queue.supporting_array = list_of_currencies.slice()
      // console.log(refresh_queue)

      inner_interval = setInterval(function() {
        if (refresh_queue.empty()) {
          clearInterval(inner_interval)
        } else {
          let curr_elem = refresh_queue.dequeue()

          d3.select("#"+curr_elem)
              .selectAll("*")
              .remove()
          socket.emit('req assessment', {currency : curr_elem})
          if (state_of_buttons[curr_elem].price) {
            socket.emit('req price n periods', {currency : curr_elem, periods : initial_time_periods})
          } else if (state_of_buttons[curr_elem].ema) {
            socket.emit('req ema n periods', {currency : curr_elem, periods : initial_time_periods})
          } else if (state_of_buttons[curr_elem].sma) {
            socket.emit('req sma n periods', {currency : curr_elem, periods : initial_time_periods})
          } else if (state_of_buttons[curr_elem].wiki) {
            socket.emit('req wiki n periods', {currency : curr_elem, periods : initial_time_periods})
          }
        }
      }, 200)
    }, 15000)

  }
</script>

<script type="text/javascript">

  // set live update interval for toggle button click
  var inner_interval = null
  var outer_interval = null

  if ($('.ui.toggle').checkbox('is checked')) {
    start_interval()
  }

  $('.ui.toggle').checkbox({
    onChecked: function () {
      console.log('checked')

      $('.ui.toggle').popup({
        title : 'off',
        on : 'click'
      })
      start_interval()
    },
    onUnchecked: function () {
      console.log('unchecked')
      $('.ui.toggle').popup({
        title : 'on',
        content : 'updates every 15s',
        on : 'click'
      })
      clearInterval(inner_interval)
      clearInterval(outer_interval)
    }
  });

</script>

<script type="text/javascript">
  function price_to_percent_change(price_array) {
    var percent_change_array = []
    for (let i = 0; i < price_array.length-1;i++) {
      percent_change_array.push(percent_change(price_array[i], price_array[i+1]))
    }
    let min = Math.abs(d3.min(percent_change_array))
    // shift values by min
    for (let i = 0; i < percent_change_array.length;i++) { percent_change_array[i] += min }
    return percent_change_array;
  }

  var percent_change = function(today_price, yesterday_price) {
    return ((today_price - yesterday_price)/yesterday_price)*100
  }

  var inverse_array = function(arr) {
    var arr_builder = []
    for (let i = arr.length-1; i >= 0;i--){arr_builder.push(arr[i])}
    return arr_builder
  }

  var price_array_to_reduced_price_array = function(price_array) {
    let min = d3.min(price_array)
    let max = d3.max(price_array)
    if (min == max) return price_array
    for (let x = 0; x < price_array.length; x++) {
      price_array[x] -= min
    }
    return price_array
  }
</script>


<script type="text/javascript">

  var res_price_n_periods = function(price_data, time_periods) {


    var minimum_val = d3.min(price_data.price_array)
    var maximum_val = d3.max(price_data.price_array)
    price_data.price_array.push(minimum_val*.999)
    // price_data.price_array.push(maximum_val*1.001)


    var n = 3 // number of series
    var m = time_periods+1
    var xz = d3.range(m)
    xz = inverse_array(xz) // inverse

    var yz = d3.range(n).map(function() {
      return price_array_to_reduced_price_array(price_data.price_array);
    })

    var y01z = d3.stack().keys(d3.range(n))(d3.transpose(yz))
    var yMax = d3.max(yz, function(y) {
      return d3.max(y);
    })
    var y1Max = d3.max(y01z, function(y) {
      return d3.max(y, function(d) {
        return d[1];
      });
    });

    var svg = d3.select("#"+price_data.symbol)
        margin = {top: 5, right: 5, bottom: 5, left: 5},
        width = +svg.attr("width") /*- margin.left - margin.right*/,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", "translate(" + 25 + "," + -10 + ")");

    var x = d3.scaleBand()
        .domain(xz)
        .rangeRound([0, width])
        .padding(0.08);

    var y = d3.scaleLinear()
        .domain([0, y1Max])
        .range([height, 0]);

    var color = d3.scaleOrdinal()
        .domain(d3.range(n))
        .range(color_arr);

    var series = g.selectAll(".series")
      .data(y01z)
      .enter().append("g")
        .attr("fill", function(d, i) { return color(i); });

    var rect = series.selectAll("rect")
      .data(function(d) { return d; })
      .enter().append("rect")
        .attr("x", function(d, i) { return x(i); })
        .attr("y", height)
        .attr("width", x.bandwidth())
        .attr("height", 0);

        // console.log(height)

    svg.append("rect")
      .attr("height", 2)
      .attr("width", width)
      .attr("x", 0)
      .attr("y", height -10)
      .attr("fill", "#000000")

    svg.append("rect")
      .attr("height", height)
      .attr("width", 2)
      .attr("x", 45)
      .attr("y", 10 )
      .attr("fill", "#000000")

    svg.append("text")
      .attr("x", 0)
      .attr("y", 25)
      .attr("font-family", "sans-serif")
      .attr("font-size", "10px")
      .text(round(maximum_val,3))

    svg.append("text")
      .attr("x", 0)
      .attr("y", height -13)
      .attr("font-family", "sans-serif")
      .attr("font-size", "10px")
      .text(round(minimum_val, 3))

    svg.append("text")
      .attr("x", 50)
      .attr("y", height + 1)
      .attr("font-family", "sans-serif")
      .attr("font-size", "10px")
      .text('past')

    svg.append("text")
      .attr("x", width*.925)
      .attr("y", height + 1)
      .attr("font-family", "sans-serif")
      .attr("font-size", "10px")
      .text('present')


    rect.transition()
        .delay(function(d, i) { return i ; })
        .attr("y", function(d) {
          // console.log(y(d[1]))
          return y(d[1]);
        })
        .attr("height", function(d) { return y(d[0]) - y(d[1]); });
  }
</script>

<script>
  var color_arr = [d3.schemeCategory20b[8], d3.schemeCategory20b[9], d3.schemeCategory20b[10], d3.schemeCategory20b[11]]

  socket.on('res price n periods', function(price_data){
    res_price_n_periods(price_data, price_data.price_array.length)
  })

  socket.on('res ema n periods', function(price_data) {
    res_price_n_periods(price_data, price_data.price_array.length)
  })

  socket.on('res sma n periods', function(price_data) {
    res_price_n_periods(price_data, price_data.price_array.length)
  })

  socket.on('res assessment', function(data) {
    // console.log(data.price_assessment)

    document.getElementById('currency_id_root_'+data.price_assessment.symbol).innerHTML = "<b> </b>" + data.price_assessment.id

    document.getElementById('currency_symbol_root_'+data.price_assessment.symbol).innerHTML = "<b> </b>" + data.price_assessment.symbol


    document.getElementById('rank_root_'+data.price_assessment.symbol).innerHTML = "<b>rank : </b>" + data.price_assessment.rank

    document.getElementById('current_price_usd_root_'+data.price_assessment.symbol).innerHTML = "<b>$/usd : </b>" + data.price_assessment.price_usd

    document.getElementById('current_price_btc_root_'+data.price_assessment.symbol).innerHTML = "<b>$/btc : </b>" + data.price_assessment.price_btc

    document.getElementById('market_cap_usd_root_'+data.price_assessment.symbol).innerHTML = "<b>marketcap usd : </b>" + data.price_assessment.market_cap_usd


    document.getElementById('twenty_four_hr_volume_root_'+data.price_assessment.symbol).innerHTML = "<b>24hr vol. : </b>" + data.price_assessment['24h_volume_usd']

    document.getElementById('total_supply_root_'+data.price_assessment.symbol).innerHTML = "<b>total supply : </b>" + data.price_assessment.total_supply

    document.getElementById('percent_change_1_hr_root_'+data.price_assessment.symbol).innerHTML = "<b>%change 1hr : </b>" + data.price_assessment.percent_change_1h

    document.getElementById('percent_change_24_hr_root_'+data.price_assessment.symbol).innerHTML = "<b>%change 24hr : </b>" + data.price_assessment.percent_change_24h

    document.getElementById('percent_change_7_days_root_'+data.price_assessment.symbol).innerHTML = "<b>%change 7d : </b>" + data.price_assessment.percent_change_7d

    document.getElementById('last_updated_root_'+data.price_assessment.symbol).innerHTML = "<b>updated : </b>" + unix_ms_to_date_string(data.price_assessment.unix_time)
  })


  socket.on('res wiki n periods', function(data) {
    console.log('got response from server', data)
    res_price_n_periods(data, data.price_array.length)

  })
</script>
